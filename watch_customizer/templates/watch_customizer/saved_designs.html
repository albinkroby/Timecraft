{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="home__container container mt-5">
    <h2>Your Saved Designs</h2>
    {% if designs %}
        <div class="row">
            {% for design in designs %}
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">{{ design.name }}</h5>
                            <p class="card-text">Created: {{ design.created_at|date:"F d, Y" }}</p>
                            <a href="{% url 'watch_customizer:customize_watch_with_id' design.customizable_watch.id %}?design_id={{ design.id }}" class="btn btn-primary">Edit Design</a>
                            <button class="btn btn-danger delete-design" data-design-id="{{ design.id }}">Delete</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>You haven't saved any designs yet.</p>
    {% endif %}
</div>

<script>
document.querySelectorAll('.delete-design').forEach(button => {
    button.addEventListener('click', function() {
        if (confirm('Are you sure you want to delete this design?')) {
            const designId = this.getAttribute('data-design-id');
            fetch(`/custom-watch/delete_design/${designId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    this.closest('.col-md-4').remove();
                    showCustomAlert('Design deleted successfully!', 'success');
                } else {
                    showCustomAlert('Error deleting design: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showCustomAlert('An error occurred while deleting the design.', 'error');
            });
        }
    });
});
</script>
{% endblock %}