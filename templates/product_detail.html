{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="home__container container mt-5">  
    <div class="row">
        <!-- Product Images -->
        <div class="col-md-5">
            <div class="main-image mb-3" style="width: 500px; height: 500px; overflow: hidden; background-color: #ffff;">
                <img id="mainImage" src="{{ watch.primary_image.url }}" alt="{{ watch.model_name }}" class="img-fluid" style="width: 100%; height: 100%; object-fit: contain;">
            </div>
            <div class="thumbnail-images d-flex column-gap-3">
                <div class="thumbnail mr-2 active">
                    <img src="{{ watch.primary_image.url }}" alt="{{ watch.model_name }}" class="img-fluid thumbnail-img" style="width: 70px; height: 60px; object-fit: cover;" onclick="changeImage(this)">
                </div>
                {% for image in watch.additional_images.all %}
                <div class="thumbnail mr-2">
                    <img src="{{ image.image.url }}" alt="{{ watch.model_name }}" class="img-fluid thumbnail-img" style="width: 70px; height: 60px; object-fit: cover;" onclick="changeImage(this)">
                </div>
                {% endfor %}
            </div>
            <div class="mt-3 row text-center">
                {% if user.is_authenticated %}
                <div class="col-md-6">
                    <button type="submit" class="w-100 button button--gray rounded" id="add-to-cart" data-watch-id="{{ watch.id }}">Add to Cart</button>
                </div>
                <div class="col-md-6">
                    <a href="{% url 'mainapp:order_review' %}?product_id={{ watch.id }}" class="w-100 button rounded">Buy Now</a>
                </div>
                {% else %}
                <div class="col-md-6">
                    <a href="{% url 'mainapp:login' %}" class="w-100 button button--gray rounded">Add to Cart</a>
                </div>
                <div class="col-md-6">
                    <a href="{% url 'mainapp:login' %}" class="w-100 button rounded">Buy Now</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Product Details -->
        <div class="col-md-7 ps-5">
            <p class="text-muted mb-1">{{ watch.brand.brand_name }}</p>
            <h1>{{ watch.model_name }}</h1>
            <h2 class="text-primary">â‚¹{{ watch.base_price }}</h2>
            <div class="mt-1 d-flex align-items-center column-gap-2">
                <p class="badge bg-success">{{ watch.average_rating|floatformat:1 }}</p>
                <p class="text-muted">{{ watch.total_reviews }} ratings</p>
            </div>
            
            <div class="mt-4">
                <h5>Product Details:</h5>
                <table class="table table-borderless">
                    <tr>
                        <th>Display Type</th>
                        <td>{{ watch.display_type }}</td>
                    </tr>
                    <tr>
                        <th>Style Code</th>
                        <td>{{ watch.style_code }}</td>
                    </tr>
                    <tr>
                        <th>Series</th>
                        <td>{{ watch.series }}</td>
                    </tr>
                    <tr>
                        <th>Occasion</th>
                        <td>{{ watch.occasion }}</td>
                    </tr>
                    <tr>
                        <th>Pack of</th>
                        <td>{{ watch.pack_of }}</td>
                    </tr>
                    <tr>
                        <th>Model Name</th>
                        <td>{{ watch.model_name }}</td>
                    </tr>
                    <tr>
                        <th>Strap Color</th>
                        <td>{{ watch.strap_color }}</td>
                    </tr>
                    <tr>
                        <th>Net Quantity</th>
                        <td>{{ watch.net_quantity }}</td>
                    </tr>
                    <tr>
                        <th>Color</th>
                        <td>{{ watch.color }}</td>
                    </tr>
                    <tr>
                        <th>Strap Material</th>
                        <td>{{ watch.strap_material }}</td>
                    </tr>
                    <tr>
                        <th>Case Size</th>
                        <td>{{ watch.case_size }} mm</td>
                    </tr>
                    <tr>
                        <th>Movement Type</th>
                        <td>{{ watch.movement_type }}</td>
                    </tr>
                    <tr>
                        <th>Water Resistance</th>
                        <td>{{ watch.water_resistance }}</td>
                    </tr>
                </table>
            </div>

            <div class="mt-3">
                <p>{{ watch.description }}</p>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    function changeImage(element) {
        var mainImage = document.getElementById('mainImage');
        mainImage.src = element.src;
        
        // Remove 'active' class from all thumbnails
        var thumbnails = document.getElementsByClassName('thumbnail');
        for (var i = 0; i < thumbnails.length; i++) {
            thumbnails[i].classList.remove('active');
        }
        
        // Add 'active' class to the clicked thumbnail
        element.parentElement.classList.add('active');
    }

    $(document).ready(function() {
        $('#add-to-cart').click(function() {
            var watchId = $(this).data('watch-id');
            $.ajax({
                url: "{% url 'mainapp:add_to_cart' 0 %}".replace('0', watchId),
                type: 'POST',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                success: function(data) {
                    if (data.success) {
                        showCustomAlert(data.message, 'success');
                    } else {
                        showCustomAlert(data.message, 'error');
                    }
                },
                error: function(xhr, status, error) {
                    var errorMessage = 'An error occurred while adding to cart.';
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        errorMessage = xhr.responseJSON.message;
                    }
                    showCustomAlert(errorMessage, 'error');
                    console.error('Error:', error);
                }
            });
        });
    });
</script>
{% endblock %}